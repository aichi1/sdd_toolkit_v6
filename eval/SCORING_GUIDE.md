# Scoring Guide (A案・固定3シナリオ)

このガイドは `/eval` の採点ブレを最小化するための手順と採点基準です。  
**必ずこの順番で採点**してください（特に「証拠→チェックリスト→軸採点→整合チェック」）。

---

## 0) 採点の原則
- **証拠（evidence）に基づく**：推測で点を上げない。
- **同じ入力→同じ採点**：毎回同じ3シナリオ・同じrubric・同じ採点手順。
- **5点は“優秀”ではなく“ほぼ理想形”**：頻発させない（原則 5 は稀）。
- **重要な欠陥がある場合は上限をかける**（下の「上限制約」参照）。

---

## 1) 採点手順（厳守）

### Step 1: 証拠収集（Evidence Map）
各シナリオについて、最低限以下を列挙する：

- 読んだファイル（パス）
  - 例：`docs/_manifest.json`, `docs/*.md`, `outputs/phase-01/*`, `outputs/**/.validation/report.md`, `README.md`
- 「期待成果物」の充足状況（存在/欠落）
- 重要な不整合（例：manifestと実ファイルの不一致）

> ここで **“見ていないもの” は採点根拠にしない**。

### Step 2: チェックリスト採点（Pass / Partial / Fail）
各シナリオの `eval/scenarios/<scenario>/checklist.json` を読み、各項目を：
- **Pass**：明確に満たす（根拠箇所がある）
- **Partial**：一部満たす/薄い
- **Fail**：満たさない/見当たらない

チェックリストの集計（目安）：
- Pass率 ≥ 90% → checklist_grade = A
- Pass率 60〜89% → checklist_grade = B
- Pass率 30〜59% → checklist_grade = C
- Pass率 < 30% → checklist_grade = D

この `checklist_grade` は **Completeness / Usability** の採点に強く反映する。

### Step 3: 軸ごとの採点（0〜5、整数）
`eval/rubric.json` の各軸について、下の「アンカー（0/1/3/5）」を参照し、  
**一度だけ** まず仮点を付け、その後「上限制約」に従って調整する。

### Step 4: 上限制約（重要）
重大な欠陥がある場合、点数の上限を適用する。

- **必須成果物（expected_manifest）の欠落がある** → Correctness は最大 2
- **チェックリストで Fail が 2件以上** → Completeness / Usability は最大 3
- **安全上の赤信号（秘密情報/危険操作の誘発）** → Safety は最大 2、かつ notes に理由を明記
- **README/導線が破綻（実行不能レベル）** → Usability は最大 2

### Step 5: 整合チェック（矛盾の解消）
以下の矛盾が起きていないか確認し、矛盾があるなら点を下げて整合させる：
- Correctness が高いのに、必須成果物が欠落している
- Efficiency が高いのに、retries/手戻りが多い
- Maintainability が高いのに、ルール/テンプレが肥大化・重複している
- Safety が高いのに、`.env`/鍵/個人情報に触れる誘導がある

---

## 2) 採点アンカー（0 / 1 / 3 / 5）

> 2点・4点は **隣接アンカーの中間**。迷ったら低い方。

### correctness（必須成果物が揃い、整合）
- **0**：評価/実行に必要な前提が欠け、進行不能（構造崩壊）
- **1**：主要成果物が不足、または整合性が大きく崩れている
- **3**：必須成果物は揃い、軽微な不整合があるが実用上問題は小さい
- **5**：必須成果物が完全に揃い、整合性も高い（矛盾がほぼない）

### completeness（抜けが少ない）
- **0**：要件/制約/成功条件/非目的などがほぼ未記載
- **1**：一部はあるが重要項目が欠け、解釈が割れる
- **3**：主要項目は揃うが、薄い箇所/抜けが少しある（checklist_grade B程度）
- **5**：主要項目が揃い、想定外・留意点も明確（checklist_grade A、かつ根拠明確）

### efficiency（手数・やり直しの少なさ）
- **0**：手順が不明瞭で手戻りが連発（retries多）
- **1**：進められるが何度も戻る/判断待ちが多い
- **3**：概ねスムーズ（retries 0〜1、手順が明確）
- **5**：最短導線で進められる（retries 0、無駄な手順なし）

### robustness（入力ゆらぎへの耐性）
- **0**：少しのゆらぎで破綻（manifest/導線が壊れる）
- **1**：条件が少し変わると大きく手直しが必要
- **3**：一般的なゆらぎには耐える（代替手順/フォールバックがある）
- **5**：複数ケースに自然に対応（例外の扱いが明確、ガードが適切）

### maintainability（更新しやすい構造）
- **0**：何をどこで直すべきか不明（スパゲッティ）
- **1**：重複/矛盾が多く、修正が怖い
- **3**：分割され、修正点が追いやすい（命名・配置が妥当）
- **5**：拡張点が明確、重複が抑制され、変更影響が限定される

### usability（人が迷いにくい）
- **0**：導線不明、README破綻
- **1**：説明不足で詰まりやすい
- **3**：普通に使える（README/手順が通る、checklist_grade B以上）
- **5**：迷いにくい（Quickstartが短い、つまずき対処もある）

### safety（秘密情報/危険操作/最小権限）
- **0**：危険な手順を推奨、秘密情報保護がない
- **1**：注意はあるがガードが弱い/抜けがある
- **3**：基本的な配慮がある（deny/ignore、注意書き、危険操作回避）
- **5**：危険領域が具体的に抑止され、誤操作にも強い（二重ガード）

---

## 3) score.json の必須項目（採点の“型”）
各 `eval/runs/<iteration_id>/<scenario>/score.json` は、最低限：

- `scores`：各軸 0〜5（整数）
- `checklist`：各項目の Pass/Partial/Fail
- `metrics`：turns, retries, manifest_fill_rate など（分かる範囲で）
- `evidence_files`：参照した主要ファイルパス配列
- `notes`：短文（改善点・理由）

---

## 4) 文章レポートの型（eval/reports）
レポートには必ず：
- **上がった/下がった軸（前回比）**
- **根拠（どの変更が効いたか）**
- **次の改善仮説（最大3つ）**
を入れる。
